using UnityEngine;
using System.Collections;
using System.Collections.Generic;
using saltr_unity_sdk;
using Assets;
using NUnit.Framework;

public class SLTLevelTest
{

    private string rootJson = "{\"status\":\"SUCCEED\",\"responseData\":{\"levelPacks\":[{\"token\":\"TLP1\",\"index\":0,\"levels\":[{\"id\":5678,\"index\":2,\"url\":\"https://saltapi.includiv.com/static_data/a78daba7-89fe-eb1a-7153-3700f699ee4e/levels/6733.json\",\"version\":3,\"properties\":{\"level_type\":\"moved\",\"moves\":3,\"stars\":\"200,300,1000\"}},{\"id\":5674,\"index\":1,\"url\":\"https://saltapi.includiv.com/static_data/a78daba7-89fe-eb1a-7153-3700f699ee4e/levels/6729.json\",\"version\":4,\"properties\":{\"level_type\":\"moved\",\"moves\":6,\"stars\":\"500,700,900\",\"boosts\":{\"crossbomb\":{\"probability\":1,\"top_margin\":1,\"bottom_margin\":2,\"max_possible\":1,\"priority\":1}}}},{\"id\":5673,\"index\":0,\"url\":\"https://saltapi.includiv.com/static_data/a78daba7-89fe-eb1a-7153-3700f699ee4e/levels/6728.json\",\"version\":7,\"properties\":{\"level_type\":\"moved\",\"moves\":4,\"stars\":\"700,1200,1800\",\"boosts\":{\"crossbomb\":{\"probability\":1,\"top_margin\":1,\"bottom_margin\":0,\"max_possible\":1,\"priority\":1}}}}]},{\"token\":\"TLP2\",\"index\":1,\"levels\":[{\"id\":5602,\"index\":1,\"url\":\"https://saltapi.includiv.com/static_data/a78daba7-89fe-eb1a-7153-3700f699ee4e/levels/6654.json\",\"version\":1,\"properties\":{\"level_type\":\"moved\",\"moves\":3,\"stars\":\"200,300,400\"}},{\"id\":5601,\"index\":0,\"url\":\"https://saltapi.includiv.com/static_data/a78daba7-89fe-eb1a-7153-3700f699ee4e/levels/6653.json\",\"version\":1,\"properties\":{\"level_type\":\"moved\",\"moves\":3,\"stars\":\"200,300,400\"}}]},{\"token\":\"air\",\"index\":2,\"levels\":[{\"id\":5700,\"index\":5,\"url\":\"https://saltapi.includiv.com/static_data/a78daba7-89fe-eb1a-7153-3700f699ee4e/levels/6755.json\",\"version\":1,\"properties\":{\"level_type\":\"moved\",\"moves\":4,\"stars\":\"200,300,400\"}},{\"id\":5712,\"index\":18,\"url\":\"https://saltapi.includiv.com/static_data/a78daba7-89fe-eb1a-7153-3700f699ee4e/levels/6767.json\",\"version\":1,\"properties\":{\"level_type\":\"moved\",\"stars\":\"900,1500,1900\",\"moves\":3,\"boosts\":{\"crossbomb\":{\"probability\":3,\"top_margin\":2,\"bottom_margin\":2,\"max_possible\":2,\"priority\":1}}}},{\"id\":5702,\"index\":7,\"url\":\"https://saltapi.includiv.com/static_data/a78daba7-89fe-eb1a-7153-3700f699ee4e/levels/6757.json\",\"version\":1,\"properties\":{\"level_type\":\"prediction\"}},{\"id\":5701,\"index\":6,\"url\":\"https://saltapi.includiv.com/static_data/a78daba7-89fe-eb1a-7153-3700f699ee4e/levels/6756.json\",\"version\":1,\"properties\":{\"level_type\":\"invite\",\"gold_awards\":\"1500,2000,2500\",\"stars\":\"40,50,60\",\"award_per_additional_friend\":40}},{\"id\":5696,\"index\":1,\"url\":\"https://saltapi.includiv.com/static_data/a78daba7-89fe-eb1a-7153-3700f699ee4e/levels/6751.json\",\"version\":1,\"properties\":{\"level_type\":\"moved\",\"stars\":\"600,800,1100\",\"moves\":3,\"boosts\":{\"crossbomb\":{\"probability\":3,\"top_margin\":2,\"bottom_margin\":2,\"max_possible\":2,\"priority\":1}}}},{\"id\":5703,\"index\":8,\"url\":\"https://saltapi.includiv.com/static_data/a78daba7-89fe-eb1a-7153-3700f699ee4e/levels/6758.json\",\"version\":1,\"properties\":{\"level_type\":\"moved\",\"moves\":6,\"stars\":\"200,300,400\"}},{\"id\":5707,\"index\":12,\"url\":\"https://saltapi.includiv.com/static_data/a78daba7-89fe-eb1a-7153-3700f699ee4e/levels/6762.json\",\"version\":1,\"properties\":{\"level_type\":\"moved\",\"moves\":4,\"stars\":\"200,300,400\"}},{\"id\":5709,\"index\":14,\"url\":\"https://saltapi.includiv.com/static_data/a78daba7-89fe-eb1a-7153-3700f699ee4e/levels/6764.json\",\"version\":1,\"properties\":{\"level_type\":\"moved\",\"stars\":\"600,800,1000\",\"moves\":4,\"boosts\":{\"crossbomb\":{\"probability\":3,\"top_margin\":2,\"bottom_margin\":2,\"max_possible\":2,\"priority\":1}}}},{\"id\":5708,\"index\":13,\"url\":\"https://saltapi.includiv.com/static_data/a78daba7-89fe-eb1a-7153-3700f699ee4e/levels/6763.json\",\"version\":1,\"properties\":{\"level_type\":\"moved\",\"moves\":6,\"stars\":\"1200,1700,2100\",\"boosts\":{\"crossbomb\":{\"probability\":1,\"top_margin\":1,\"bottom_margin\":3,\"max_possible\":1,\"priority\":1}}}},{\"id\":5704,\"index\":16,\"url\":\"https://saltapi.includiv.com/static_data/a78daba7-89fe-eb1a-7153-3700f699ee4e/levels/6759.json\",\"version\":1,\"properties\":{\"level_type\":\"moved\",\"stars\":\"700,1200,2300\",\"moves\":5,\"boosts\":{\"crossbomb\":{\"probability\":3,\"top_margin\":2,\"bottom_margin\":2,\"max_possible\":2,\"priority\":1}}}},{\"id\":5697,\"index\":2,\"url\":\"https://saltapi.includiv.com/static_data/a78daba7-89fe-eb1a-7153-3700f699ee4e/levels/6752.json\",\"version\":1,\"properties\":{\"level_type\":\"moved\",\"moves\":4,\"stars\":\"200,300,400\"}},{\"id\":5698,\"index\":3,\"url\":\"https://saltapi.includiv.com/static_data/a78daba7-89fe-eb1a-7153-3700f699ee4e/levels/6753.json\",\"version\":1,\"properties\":{\"level_type\":\"moved\",\"moves\":4,\"stars\":\"200,300,400\"}},{\"id\":5705,\"index\":9,\"url\":\"https://saltapi.includiv.com/static_data/a78daba7-89fe-eb1a-7153-3700f699ee4e/levels/6760.json\",\"version\":1,\"properties\":{\"level_type\":\"moved\",\"moves\":4,\"stars\":\"300,500,750\",\"boosts\":{\"crossbomb\":{\"probability\":1,\"top_margin\":3,\"bottom_margin\":0,\"max_possible\":1,\"priority\":1}}}},{\"id\":5695,\"index\":0,\"url\":\"https://saltapi.includiv.com/static_data/a78daba7-89fe-eb1a-7153-3700f699ee4e/levels/6750.json\",\"version\":1,\"properties\":{\"level_type\":\"moved\",\"moves\":2,\"stars\":\"200,300,400\"}},{\"id\":5710,\"index\":15,\"url\":\"https://saltapi.includiv.com/static_data/a78daba7-89fe-eb1a-7153-3700f699ee4e/levels/6765.json\",\"version\":1,\"properties\":{\"level_type\":\"moved\",\"stars\":\"1000,1500,2000\",\"moves\":3,\"boosts\":{\"crossbomb\":{\"probability\":3,\"top_margin\":2,\"bottom_margin\":2,\"max_possible\":2,\"priority\":1}}}},{\"id\":5714,\"index\":20,\"url\":\"https://saltapi.includiv.com/static_data/a78daba7-89fe-eb1a-7153-3700f699ee4e/levels/6769.json\",\"version\":1,\"properties\":{\"level_type\":\"moved\",\"stars\":\"900,1400,1600\",\"moves\":4,\"boosts\":{\"crossbomb\":{\"probability\":1,\"top_margin\":2,\"bottom_margin\":1,\"max_possible\":1,\"priority\":1}}}},{\"id\":5681,\"index\":11,\"url\":\"https://saltapi.includiv.com/static_data/a78daba7-89fe-eb1a-7153-3700f699ee4e/levels/6736.json\",\"version\":1,\"properties\":{\"level_type\":\"prediction\"}},{\"id\":5706,\"index\":10,\"url\":\"https://saltapi.includiv.com/static_data/a78daba7-89fe-eb1a-7153-3700f699ee4e/levels/6761.json\",\"version\":1,\"properties\":{\"level_type\":\"moved\",\"moves\":3,\"stars\":\"600,900,1300\",\"boosts\":{\"crossbomb\":{\"probability\":1,\"top_margin\":1,\"bottom_margin\":3,\"max_possible\":1,\"priority\":1}}}},{\"id\":5713,\"index\":19,\"url\":\"https://saltapi.includiv.com/static_data/a78daba7-89fe-eb1a-7153-3700f699ee4e/levels/6768.json\",\"version\":1,\"properties\":{\"level_type\":\"moved\",\"moves\":15,\"stars\":\"3000,4000,5000\",\"boosts\":{\"crossbomb\":{\"probability\":4,\"top_margin\":3,\"bottom_margin\":3,\"max_possible\":3,\"priority\":1}}}},{\"id\":5711,\"index\":17,\"url\":\"https://saltapi.includiv.com/static_data/a78daba7-89fe-eb1a-7153-3700f699ee4e/levels/6766.json\",\"version\":1,\"properties\":{\"level_type\":\"moved\",\"moves\":6,\"stars\":\"2000,3000,4500\",\"boosts\":{\"crossbomb\":{\"probability\":3,\"top_margin\":2,\"bottom_margin\":1,\"max_possible\":2,\"priority\":1}}}},{\"id\":5717,\"index\":23,\"url\":\"https://saltapi.includiv.com/static_data/a78daba7-89fe-eb1a-7153-3700f699ee4e/levels/6772.json\",\"version\":1,\"properties\":{\"level_type\":\"moved\",\"stars\":\"700,800,1000\",\"moves\":5,\"boosts\":{\"crossbomb\":{\"probability\":3,\"top_margin\":2,\"bottom_margin\":2,\"max_possible\":2,\"priority\":1}}}},{\"id\":5715,\"index\":21,\"url\":\"https://saltapi.includiv.com/static_data/a78daba7-89fe-eb1a-7153-3700f699ee4e/levels/6770.json\",\"version\":1,\"properties\":{\"level_type\":\"moved\",\"moves\":5,\"stars\":\"900,1600,2400\",\"boosts\":{\"crossbomb\":{\"probability\":4,\"top_margin\":3,\"bottom_margin\":3,\"max_possible\":2,\"priority\":1}}}},{\"id\":5699,\"index\":4,\"url\":\"https://saltapi.includiv.com/static_data/a78daba7-89fe-eb1a-7153-3700f699ee4e/levels/6754.json\",\"version\":1,\"properties\":{\"level_type\":\"moved\",\"moves\":4,\"stars\":\"200,300,400\"}},{\"id\":5716,\"index\":22,\"url\":\"https://saltapi.includiv.com/static_data/a78daba7-89fe-eb1a-7153-3700f699ee4e/levels/6771.json\",\"version\":1,\"properties\":{\"level_type\":\"moved\",\"stars\":\"800,1000,1400\",\"moves\":7,\"boosts\":{\"crossbomb\":{\"probability\":2,\"top_margin\":3,\"bottom_margin\":0,\"max_possible\":1,\"priority\":1}}}}]}],\"features\":[{\"token\":\"FEATURE1\",\"data\":{\"a\":\"1\"}},{\"token\":\"SCORE_CONFIGURATION\",\"data\":{\"POINTS_JJ_QQ_KK\":\"150\",\"POINTS_CARD_FLIP\":\"25\",\"POINTS_CARD_UNLOCK\":\"50\",\"POINTS_DEATH_CARD_DESTROY\":\"500\",\"POINTS_CROSS_BOMB_COLLECTED_CARDS\":\"100\",\"POINTS_UNIQUE_MOVE\":\"400\",\"POINTS_CARD_MATCH_2\":\"100\",\"POINTS_CARD_MATCH_3\":\"200\",\"POINTS_CARD_MATCH_4\":\"250\",\"POINTS_CARD_MATCH_5\":\"300\",\"POINTS_CARD_MATCH_6\":\"400\",\"POINTS_MINE_CARD\":\"150\"}},{\"token\":\"YAYAYA\",\"data\":{}}],\"experimentInfo\":[{\"token\":\"EXPFEATURE1\",\"partition\":\"A\",\"type\":\"feature\",\"trackingType\":\"all\"},{\"token\":\"EXP2\",\"partition\":\"A\",\"type\":\"pack\",\"trackingType\":\"all\"}],\"saltrUserId\":\"85fa1431-34ab-4183-9eac-c9ea678f05f5\"}}";
    private string levelContentJson = "{\"boards\":{\"main\":{\"layers\":[{\"layerId\":\"default\",\"composites\":[{\"assetId\":1884,\"position\":[1,3]}],\"chunks\":[{\"chunkId\":1,\"assets\":[{\"assetId\":1835,\"distributionType\":\"count\",\"distributionValue\":1,\"stateId\":407}],\"cells\":[[1,1]]},{\"chunkId\":2,\"assets\":[{\"assetId\":1881,\"distributionType\":\"count\",\"distributionValue\":4}],\"cells\":[[2,1],[3,1],[1,0],[4,0]]},{\"chunkId\":3,\"assets\":[{\"assetId\":1835,\"distributionType\":\"count\",\"distributionValue\":1},{\"assetId\":1837,\"distributionType\":\"count\",\"distributionValue\":1},{\"assetId\":1876,\"distributionType\":\"count\",\"distributionValue\":1}],\"cells\":[[0,2],[0,1],[0,0]]},{\"chunkId\":4,\"assets\":[{\"assetId\":1845,\"distributionType\":\"count\",\"distributionValue\":1}],\"cells\":[[5,2]]},{\"chunkId\":5,\"assets\":[{\"assetId\":1837,\"distributionType\":\"count\",\"distributionValue\":1,\"stateId\":406}],\"cells\":[[4,1]]},{\"chunkId\":6,\"assets\":[{\"assetId\":1831,\"distributionType\":\"count\",\"distributionValue\":1},{\"assetId\":1832,\"distributionType\":\"count\",\"distributionValue\":1}],\"cells\":[[5,1],[5,0]]},{\"chunkId\":7,\"assets\":[{\"assetId\":1839,\"distributionType\":\"count\",\"distributionValue\":1},{\"assetId\":1836,\"distributionType\":\"count\",\"distributionValue\":1}],\"cells\":[[2,0],[3,0]]},{\"chunkId\":8,\"assets\":[{\"assetId\":1847,\"distributionType\":\"count\",\"distributionValue\":1}],\"cells\":[[0,3]]},{\"chunkId\":9,\"assets\":[{\"assetId\":1862,\"distributionType\":\"count\",\"distributionValue\":1}],\"cells\":[[5,3]]}],\"fixedAssets\":[]}],\"rows\":6,\"cols\":6}},\"assetStates\":{\"383\":\"crystal_closed9\",\"384\":\"crystal_opened9\",\"381\":\"crystal_locked8\",\"382\":\"locked8\",\"380\":\"closed8\",\"389\":\"crystal_opened10\",\"388\":\"crystal_closed10\",\"387\":\"locked9\",\"386\":\"crystal_locked9\",\"385\":\"closed9\",\"349\":\"crystal_closed2\",\"370\":\"closed6\",\"371\":\"crystal_locked6\",\"342\":\"crystal_closed1\",\"372\":\"locked6\",\"343\":\"crystal_opened1\",\"373\":\"crystal_closed7\",\"344\":\"closed1\",\"345\":\"crystal_locked2\",\"346\":\"crystal_opened5\",\"347\":\"locked2\",\"348\":\"test2\",\"379\":\"crystal_opened8\",\"378\":\"crystal_closed8\",\"405\":\"closed\",\"375\":\"closed7\",\"404\":\"crystal_opened\",\"374\":\"crystal_opened7\",\"407\":\"locked\",\"377\":\"locked7\",\"406\":\"crystal_locked\",\"376\":\"crystal_locked7\",\"401\":\"crystal_locked12\",\"400\":\"closed12\",\"403\":\"crystal_closed\",\"402\":\"locked12\",\"361\":\"crystal_opened4\",\"362\":\"closed4\",\"360\":\"crystal_closed4\",\"366\":\"crystal_locked5\",\"365\":\"crystal_closed5\",\"364\":\"locked4\",\"363\":\"crystal_locked4\",\"369\":\"crystal_opened6\",\"368\":\"crystal_closed6\",\"367\":\"locked5\",\"391\":\"crystal_locked10\",\"390\":\"closed10\",\"393\":\"crystal_closed11\",\"392\":\"locked10\",\"395\":\"closed11\",\"394\":\"crystal_opened11\",\"350\":\"crystal_opened2\",\"351\":\"closed2\",\"353\":\"closed5\",\"352\":\"crystal_locked1\",\"355\":\"crystal_closed3\",\"354\":\"locked3\",\"357\":\"closed3\",\"356\":\"crystal_opened3\",\"359\":\"locked1\",\"358\":\"crystal_locked3\",\"396\":\"crystal_locked11\",\"397\":\"locked11\",\"398\":\"crystal_closed12\",\"399\":\"crystal_opened12\"},\"assets\":{\"1868\":{\"states\":[407,406,405,404,403],\"type\":\"regular39\"},\"1867\":{\"states\":[407,406,405,404,403],\"type\":\"regular38\"},\"1869\":{\"states\":[407,406,405,404,403],\"type\":\"regular40\"},\"1860\":{\"states\":[407,406,405,404,403],\"type\":\"regular31\"},\"1862\":{\"states\":[407,406,405,404,403],\"type\":\"regular33\"},\"1861\":{\"states\":[407,406,405,404,403],\"type\":\"regular32\"},\"1864\":{\"states\":[407,406,405,404,403],\"type\":\"regular35\"},\"1863\":{\"states\":[407,406,405,404,403],\"type\":\"regular34\"},\"1866\":{\"states\":[407,406,405,404,403],\"type\":\"regular37\"},\"1865\":{\"states\":[407,406,405,404,403],\"type\":\"regular36\"},\"1829\":{\"states\":[407,406,405,404,403],\"type\":\"regular\"},\"1859\":{\"states\":[407,406,405,404,403],\"type\":\"regular30\"},\"1858\":{\"states\":[407,406,405,404,403],\"type\":\"regular29\"},\"1857\":{\"states\":[407,406,405,404,403],\"type\":\"regular28\"},\"1856\":{\"states\":[407,406,405,404,403],\"type\":\"regular27\"},\"1851\":{\"states\":[407,406,405,404,403],\"type\":\"regular22\"},\"1850\":{\"states\":[407,406,405,404,403],\"type\":\"regular21\"},\"1855\":{\"states\":[407,406,405,404,403],\"type\":\"regular26\"},\"1854\":{\"states\":[407,406,405,404,403],\"type\":\"regular25\"},\"1853\":{\"states\":[407,406,405,404,403],\"type\":\"regular24\"},\"1852\":{\"states\":[407,406,405,404,403],\"type\":\"regular23\"},\"1885\":{\"states\":[],\"type\":\"regular51\"},\"1882\":{\"states\":[],\"type\":\"chest_in_the_middle_2x3\",\"cellInfos\":[[0,0],[1,0],[2,0],[0,1],[1,1],[2,1]]},\"1881\":{\"states\":[],\"type\":\"death\"},\"1884\":{\"states\":[],\"type\":\"chest_in_the_middle_2x4\",\"cellInfos\":[[0,0],[1,0],[2,0],[3,0],[0,1],[1,1],[2,1],[3,1]]},\"1883\":{\"states\":[],\"type\":\"super_death\"},\"1843\":{\"states\":[407,406,405,404,403],\"type\":\"regular14\"},\"1844\":{\"states\":[407,406,405,404,403],\"type\":\"regular15\"},\"1841\":{\"states\":[407,406,405,404,403],\"type\":\"regular12\"},\"1842\":{\"states\":[407,406,405,404,403],\"type\":\"regular13\"},\"1840\":{\"states\":[407,406,405,404,403],\"type\":\"regular11\"},\"1849\":{\"states\":[407,406,405,404,403],\"type\":\"regular20\"},\"1847\":{\"states\":[407,406,405,404,403],\"type\":\"regular18\"},\"1848\":{\"states\":[407,406,405,404,403],\"type\":\"regular19\"},\"1845\":{\"states\":[407,406,405,404,403],\"type\":\"regular16\"},\"1846\":{\"states\":[407,406,405,404,403],\"type\":\"regular17\"},\"1879\":{\"states\":[407,406,405,404,403],\"type\":\"regular50\"},\"1878\":{\"states\":[407,406,405,404,403],\"type\":\"regular49\"},\"1877\":{\"states\":[407,406,405,404,403],\"type\":\"regular48\"},\"1876\":{\"states\":[407,406,405,404,403],\"type\":\"regular47\"},\"1875\":{\"states\":[407,406,405,404,403],\"type\":\"regular46\"},\"1874\":{\"states\":[407,406,405,404,403],\"type\":\"regular45\"},\"1873\":{\"states\":[407,406,405,404,403],\"type\":\"regular44\"},\"1872\":{\"states\":[407,406,405,404,403],\"type\":\"regular43\"},\"1871\":{\"states\":[407,406,405,404,403],\"type\":\"regular42\"},\"1870\":{\"states\":[407,406,405,404,403],\"type\":\"regular41\"},\"1830\":{\"states\":[407,406,405,404,403],\"type\":\"regular1\"},\"1880\":{\"states\":[],\"type\":\"chest_on_top\",\"cellInfos\":[[0,0],[1,0],[2,0],[3,0],[4,0],[5,0]]},\"1831\":{\"states\":[407,406,405,404,403],\"type\":\"regular2\"},\"1832\":{\"states\":[407,406,405,404,403],\"type\":\"regular3\"},\"1833\":{\"states\":[407,406,405,404,403],\"type\":\"regular4\"},\"1838\":{\"states\":[407,406,405,404,403],\"type\":\"regular9\"},\"1839\":{\"states\":[407,406,405,404,403],\"type\":\"regular10\"},\"1834\":{\"states\":[407,406,405,404,403],\"type\":\"regular5\"},\"1835\":{\"states\":[407,406,405,404,403],\"type\":\"regular6\"},\"1836\":{\"states\":[407,406,405,404,403],\"type\":\"regular7\"},\"1837\":{\"states\":[407,406,405,404,403],\"type\":\"regular8\"}},\"properties\":{\"level_type\":\"moved\",\"moves\":3,\"stars\":\"200,300,400\"}}";


    [Test]
    public void test_SLTLevelInitialization()
    {
        Dictionary<string, object> properties = new Dictionary<string, object>();
        properties["key1"] = "1property";
        properties["key2"] = "2property";
        properties["key3"] = "3property";
        string id = "12";
        int index = 3;
        string contentUrl = @"https://saltapi.includiv.com/static_data/a78daba7-89fe-eb1a-7153-3700f699ee4e/levels/6728.json\";
        string version = "007";
        SLTLevel level = new SLTLevel(id, index, contentUrl, properties, version);

        Assert.AreEqual(id, level.id);
        Assert.AreEqual(index, level.index);
        Assert.AreEqual(contentUrl, level.contentDataUrl);
        Assert.AreEqual(properties, level.properties);
        Assert.AreEqual(version, version);

    }

    [Test]
    public void test_levelBoardParser()
    {
        SLTLevel level = new SLTLevel(" ", 0, " ", null, null);
        object obj = MiniJSON.Json.Deserialize(levelContentJson);

        level.updateContent(MiniJSON.Json.Deserialize(levelContentJson).toDictionaryOrNull());

        foreach (var item in level.boards.Keys)
        {
            SLTLevelBoard board = level.boards[item] as SLTLevelBoard;

            Assert.AreNotEqual(null, board.layers);
            Assert.AreNotEqual(null, board);
            Assert.AreEqual(6, board.cells.height);
            Assert.AreEqual(6, board.cells.width);
        }
    }
}
